#!/dis/sh.dis
# Infernode shell initialization for macOS
load std

# Set command search path
path=(/dis .)

# Get username from Inferno
user="{cat /dev/user}

# Mount namespace generator (runs in background - it's a 9P server)
mount -ac {mntgen} /n &

# Mount LLM filesystem if server is running (optional, non-blocking)
mount -A tcp!127.0.0.1!5641 /n/llm >[2] /dev/null

# Mount host filesystem (runs in background - it's a 9P server)
mkdir -p /n/local
trfs '#U*' /n/local &

# Give servers time to initialize
sleep 1

# Set home directory (macOS: /Users/username)
home=/n/local/Users/^$user

# Create tmp directory and bind to /tmp
mkdir -p $home/tmp
bind -bc $home/tmp /tmp

# Change to home directory
cd $home
